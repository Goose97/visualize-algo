{"ast":null,"code":"import _Reflect$construct from \"@babel/runtime-corejs2/core-js/reflect/construct\";\nimport _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = _Reflect$construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !_Reflect$construct) return false; if (_Reflect$construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(_Reflect$construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from 'react';\n\nvar withReverseStep = function withReverseStep(Page) {\n  var WrapperComponent = /*#__PURE__*/function (_Component) {\n    _inherits(WrapperComponent, _Component);\n\n    var _super = _createSuper(WrapperComponent);\n\n    function WrapperComponent(props) {\n      var _this;\n\n      _classCallCheck(this, WrapperComponent);\n\n      _this = _super.call(this, props);\n\n      _defineProperty(_assertThisInitialized(_this), \"reverseLogs\", void 0);\n\n      _defineProperty(_assertThisInitialized(_this), \"stepSnapshots\", void 0);\n\n      _defineProperty(_assertThisInitialized(_this), \"ref\", void 0);\n\n      _defineProperty(_assertThisInitialized(_this), \"saveReverseLog\", function (reverseActionName, params, step) {\n        var action = {\n          name: reverseActionName,\n          params: params,\n          step: step\n        };\n\n        _this.reverseLogs.push(action);\n\n        _this.forceUpdate();\n      });\n\n      _defineProperty(_assertThisInitialized(_this), \"saveStepSnapshots\", function (snapshot, step) {\n        _this.stepSnapshots.push({\n          snapshot: snapshot,\n          step: step\n        });\n      });\n\n      _defineProperty(_assertThisInitialized(_this), \"reverseToStep\", function _callee(targetStep) {\n        var snapshotOfTargetStep, handler;\n        return _regeneratorRuntime.async(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                snapshotOfTargetStep = _this.stepSnapshots.find(function (_ref) {\n                  var step = _ref.step;\n                  return step === targetStep;\n                });\n\n                if (snapshotOfTargetStep) {\n                  //@ts-ignore\n                  handler = _this.getRef().handleReverse;\n                  handler(snapshotOfTargetStep.snapshot);\n                }\n\n              case 2:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, null, null, null, _Promise);\n      });\n\n      _this.state = {};\n      _this.reverseLogs = [];\n      _this.stepSnapshots = [];\n      _this.ref = React.createRef();\n      return _this;\n    }\n\n    _createClass(WrapperComponent, [{\n      key: \"getLastStepToReverse\",\n      value: function getLastStepToReverse() {\n        var length = this.reverseLogs.length;\n        return length ? this.reverseLogs[length - 1] : null;\n      }\n    }, {\n      key: \"getRef\",\n      value: function getRef() {\n        var component = this.ref.current;\n        return component || {};\n      }\n    }, {\n      key: \"render\",\n      value: function render() {\n        return __jsx(Page, _extends({}, this.props, {\n          ref: this.ref,\n          saveReverseLog: this.saveReverseLog,\n          reverseToStep: this.reverseToStep,\n          saveStepSnapshots: this.saveStepSnapshots\n        }));\n      }\n    }]);\n\n    return WrapperComponent;\n  }(Component);\n\n  return WrapperComponent; // return React.forwardRef((props: P, ref) => (\n  //   //@ts-ignore\n  //   <WrapperComponent innerRef={ref} {...props} />\n  // ));\n};\n\nexport default withReverseStep;","map":null,"metadata":{},"sourceType":"module"}